# name: Update Flake Lock

# on:
#   schedule:
#     - cron: '0 0 * * *'  # Run daily at midnight UTC

# jobs:
#   update-flake-lock:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Install Nix 
#         run: |
#           sudo apt-get 
#       - name: Check out code
#         uses: actions/checkout@v4

#       - name: Update Flake Lock
#         run: |
#           nix flake update
#           git config user.name "GitHub Actions"
#           git config user.email "aidangibson310@gmail.com"
#           git add flake.lock
#           git commit -m "Auto-update flake.lock"
#           git push --quiet --set-upstream origin ${{ github.ref }}
#         env:
#           GITHUB_TOKEN: ${{ secrets.TOKEN }}

# install nix action https://github.com/marketplace/actions/install-nix then 
# name: "Update-Flake-Lock"
# on:
#   pull_request:
#   push:
# jobs:
#   tests:
#     runs-on: ubuntu-latest
#     steps:
#     - uses: actions/checkout@v3
#     - uses: cachix/install-nix-action@v22
#       with:
#         github_access_token: ${{ secrets.TOKEN }}
#     - run: nix build
#     - run: nix flake check

# - name: Update Nix Flake Lock
# uses: DeterminateSystems/update-flake-lock@v20


# https://github.com/marketplace/actions/update-nix-flake-lock
name: update-flake-lock
on:
  workflow_dispatch: # allows manual triggering
  schedule:
    - cron: '0 0 * * 0' # runs weekly on Sunday at 00:00

jobs:
  lockfile:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Install Nix
        uses: DeterminateSystems/nix-installer-action@main
      - name: Update flake.lock
        uses: DeterminateSystems/update-flake-lock@main
        with:
          pr-title: "Update flake.lock" # Title of PR to be created
          pr-labels: |                  # Labels to be set on the PR
            dependencies
            automated